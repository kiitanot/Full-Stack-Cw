<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/027c90a952.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script src="products.js"></script>
    <title>Petstore App</title>
</head>


<body>






    <div id="app">


        <header>
            <nav>
                <div class="nav">
                    <ul>
                        <h2 v-text="sitename"></h2>
                    </ul>

                    <form action> <input type="text" placeholder="search" ></form>

                    
                    <button class="nav-button" v-on:click="showCheckout"> {{ itemsInTheCart }}
                        <span class="fa-solid fa-cart-shopping fa-2xs"> </span> Checkout
                    </button>
                </div>
            </nav>
        </header>





        <main>



            <div v-if="showProduct">
                <div v-for="product in sortedProducts" :key="product.id">
                    <figure>
                        <img v-bind:src="product.image" alt="image">
                    </figure>




                    <h1 v-text="product.title"></h1> <br>
                    <p v-text="product.description"></p> <br>
                    <p>Price: {{product.price}}</p> <br>


                    <div>
                        <span v-for="n in product.rating">★</span>
                        <span v-for="n in 5 - product.rating">☆</span>
                    </div> <br>


                    <button class="hb" v-if="canAddToTheCart(product)" v-on:click="addItemToTheCart(product)">Add To The
                        Cart</button>
                    <button class="hbd" v-else disabled>Add To The Cart</button>




                    <span v-if="itemsLeft(product) === 0"> All Out!</span>
                    <span v-else-if="itemsLeft(product) < 5"> Only {{itemsLeft(product)}} left!</span>
                    <span v-else> Buy now!</span>
                </div>
            </div>




            <div class="Checkout" v-else>
                <h1>Welcome to the Checkout page</h1>
                <p> <br>
                    <strong> Name: </strong>
                    <input type="text" class="form-input" v-model.trim="order.name">
                </p> <br>
                <p>
                    <strong> Surname: </strong>
                    <input type="text" class="form-input" v-model.trim="order.surname">
                </p> <br>
                <p>
                    <strong> Address: </strong>
                    <input type="text" class="form-input" v-model.trim="order.Address">
                </p> <br>
                <p>
                    <strong>State: </strong>
                    <select class="form-input" v-model="order.State">
                        <option disabled selected>Select State</option>
                        <option v-for="(state, key) in states" v-bind:value="key">{{state}}</option>
                    </select>
                </p> <br>
                <p>
                    <strong> Zip/Postal code: </strong>
                    <input type="alphanumeric" class="form-input" v-model.number="order.Zip">
                </p> <br>
                <p>
                    <input type="checkbox" id="gift" v-model="order.gift" :true-value="order.sendGift"
                        :false-value="order.doNotSendGift">
                    <label for="gift">Send as a gift? </label>
                </p> <br>
                <p>
                    <input type="radio" id="home" value="Home" v-model="order.method">
                    <label for="home">Home</label>


                    <input type="radio" id="business" value="Business" v-model="order.method">
                    <label for="business">Business</label>
                </p> <br>






                <h2> Order Information </h2> <br>


                <p> <strong> Name: </strong> {{order.name}} </p> <br>
                <p>
                    <strong> Surname: </strong> {{order.surname}}
                </p> <br>
                <p>
                    <strong> Address: </strong> {{order.Address}}
                </p> <br>
                <p>
                    <strong>State:</strong> {{order.State}}
                </p> <br>
                <p>
                    <strong> Zip/Postal code: </strong> {{order.Zip}}
                </p> <br>
                <p>
                    <strong> Gift? </strong> {{order.gift}}
                </p> <br>
                <p>
                    <strong> Delivery Address: </strong> {{order.method}}
                </p> <br>
                <button class="hb" v-on:click="submitCheckOutForm"> Place Order </button>
            </div>
        </main>




        <script>
            let webstore = new Vue({
                el: "#app",
                data: {
                    sitename: "Online lessons",
                    showProduct: true,
                    // product: {
                    //    id: 1001,
                    //    title: "Cat Food, 25lb bag",
                    //    description: "A 25 pound bag of irresistible," +
                    //    " organic goodness for your cat.",
                    //    price: 2000,
                    //    image: "images/product-fullsize.jpg",
                    //    availableInventory: 10,
                    //    rating: 3
                    // },
                    products: [], products,
                    cart: [],
                    order: {
                        name: "",
                        surname: "",
                        Address: "",
                        State: "",
                        Zip: "",
                        gift: "Do not send as a gift",
                        sendGift: "Send as a gift",
                        doNotSendGift: "Do not send as a gift",
                        method: "Home"
                    },



                    states: {
                        AL: "Alabama",
                        AR: "Arizona",
                        CA: "California",
                        NV: "Nevada",
                    }
                },

                created: function () {
                    // fetch("http://localhost:3000/collections/products").then(
                    //     function(response) {
                    //         response.text().then(
                    //             function(text) {
                    //                 alert(text);
                    //             }
                    //         )
                    //     }
                    // )

                    // fetch("http://localhost:3000/collections/products").then(
                    //     function (response) {
                    //         response.json().then(
                    //             function(json) {
                    //                // alert(json);
                    //                 //console.log(json);
                    //                 webstore.products = json;
                    //             }
                    //         )
                    //     }
                    // )

                },

                methods: {
                    showCheckout: function () {
                        if (this.showProduct) { this.showProduct = false }
                        else { this.showProduct = true }
                    },
                    addItemToTheCart: function (product) {
                        this.cart.push(product.id);
                    },
                    submitCheckOutForm() {
                        alert("Congratulations, order submitted :)")
                    },
                    canAddToTheCart(product) {
                        return product.availableInventory > this.cartCount(product.id);
                    },
                    cartCount(id) {
                        let count = 0;
                        for (let i = 0; i < this.cart.length; i++) {
                            if (this.cart[i] === id) {
                                count++;
                            }
                        }


                        return count;
                    },
                    itemsLeft(product) {
                        return product.availableInventory - this.cartCount(product.id);
                    }
                },


                computed: {
                    itemsInTheCart: function () {
                        return this.cart.length || "";
                    },


                    sortedProducts() {


                        return this.products.sort((a, b) => a.price - b.price);
                    }


                }
            })
        </script>
</body>


</html>